{"version":3,"sources":["theme.js"],"names":[],"mappings":"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","file":"theme.js","sourcesContent":["'use strict';\nimport bower from 'bower';\nimport when from 'when';\nimport Path from 'path';\nimport mkdirp from 'mkdirp';\nimport _ from 'lodash';\nimport File from 'fs-extra';\nimport del from 'del';\nimport 'source-map-support/register';\n\n/**\n * The class that installs themes.\n * @class  Theme\n */\nclass Theme {\n  constructor(options) {\n      this.bower = bower;\n      this.options = {\n        bower: {\n          path: options.bower,\n          dir: {\n            path: Path.join(options.target, 'bower_components')\n          },\n          isEnabled: () => {\n            return !!options.bower;\n          }\n        },\n        target: {\n          path: options.target\n        }\n      };\n      this.setup();\n    }\n    /** \n     * Sets up the package to install\n     * bower components\n     */\n  setup() {\n      try {\n        this.package = require(this.options.bower.path);\n      } catch (error) {}\n\n      if (!this.package) {\n        try {\n          this.package = require('../bower');\n        } catch (error) {}\n      }\n\n    }\n    /** \n     * Installs the theme and its assets\n     * @return {Function} The promise\n     */\n  install() {\n    let d = when.defer();\n\n    /** \n     * The commands to install the theme\n     * @type {object}\n     */\n    let commands = {\n      /** \n       * Installs the theme through bower\n       * @param  {String} theme The theme to install\n       * @return {Function}       The promise\n       */\n      installTheme: (theme) => {\n        var d = when.defer();\n\n        if (!theme)\n          _.forEach(this.package, (value, key) => {\n            if (key === 'devDependencies' || key === 'dependencies')\n              _.forEach(this.package[key], (v, k) => {\n                if (k.indexOf('doxx-theme-') > -1) {\n                  theme = k;\n                }\n              });\n          });\n        this.bower.commands\n          .install([theme], {\n            save: true\n          }).on('end', () => {\n            d.resolve(theme);\n          });\n        return d.promise;\n      },\n      /**\n       * Copies the bower dir to the target dir\n       * @param  {String} theme The theme to install\n       * @return {Function}       The promise\n       */\n      copyBower: (theme) => {\n        let d = when.defer();\n\n        // Sources\n        var src = {\n          bower: Path.join(this.bower.config.cwd, 'bower_components/')\n        };\n        // Destinations\n        var dest = {\n          bower: this.options.bower.dir.path\n        };\n        // Copy the bower src file\n        File.copy(src.bower, dest.bower, {\n          clobber: true\n        }, (error) => {\n          if (error) d.reject(error);\n          else {\n            d.resolve({\n              theme, src, dest\n            });\n          }\n        });\n        return d.promise;\n      },\n      /**\n       * Removes the original bower dir\n       * @param  {object} result The result\n       * @return {Function}        The promise\n       */\n      removeBowerSrc: (result) => {\n        let d = when.defer();\n        let {\n          src\n        } = result;\n        del([src.bower]).then(() => {\n          d.resolve(result);\n        });\n        return d.promise;\n      },\n      /** \n       * Copies the asset dir from the copied bower dir\n       * @param  {object} result The result\n       * @return {Function}        The promise\n       */\n      copyAssets: (result) => {\n        let d = when.defer();\n        var {\n          theme, src, dest\n        } = result;\n        _.extend(src, {\n          assets: {\n            dir: Path.join(Path.join(\n                this.options.target.path, 'bower_components/'),\n              theme + '/assets/')\n          }\n        });\n        _.extend(dest, {\n          assets: {\n            dir: Path.join(this.options.target.path, 'assets/')\n          }\n        });\n\n        File.copy(src.assets.dir, dest.assets.dir, {\n          clobber: true\n        }, error => {\n          if (error) d.reject(error);\n          else {\n            d.resolve(result);\n          }\n        });\n        return d.promise;\n      },\n      /**\n       * Copies the css dir from the assets dir\n       * @param  {object} result The result\n       * @return {Function}        The promise\n       */\n      copyAssetCSS: (result) => {\n        let d = when.defer();\n        var {\n          theme, src, dest\n        } = result;\n        _.extend(src.assets, {\n          css: Path.join(Path.join(\n              this.options.target.path, 'bower_components/'),\n            theme + '/assets/css/')\n        });\n        _.extend(dest.assets, {\n          css: Path.join(this.options.target.path, 'css/')\n        });\n        File.copy(src.assets.css, dest.assets.css, {\n          clobber: true\n        }, error => {\n          if (error) d.reject(error);\n          else {\n            d.resolve(result);\n          }\n        });\n        return d.promise;\n      },\n      /**\n       * Copies the js dir from the assets dir\n       * @param  {object} result The result\n       * @return {Function}        The promise\n       */\n      copyAssetJS: (result) => {\n        let d = when.defer();\n        var {\n          theme, src, dest\n        } = result;\n        _.extend(src.assets, {\n          js: Path.join(Path.join(\n              this.options.target.path, 'bower_components/'),\n            theme + '/assets/js')\n        });\n        _.extend(dest.assets, {\n          js: Path.join(this.options.target.path, 'js/')\n        });\n        File.copy(src.assets.js, dest.assets.js, {\n          clobber: true\n        }, error => {\n          if (error) d.reject(error);\n          else {\n            d.resolve(result);\n          }\n        });\n        return d.promise;\n      },\n      /**\n       * Removes the assets dir from the target\n       * @param  {object} result The result\n       * @return {Function}        The promise\n       */\n      deleteAssets: (result) => {\n        let d = when.defer();\n        var {\n          dest\n        } = result;\n        del([dest.assets.dir]).then(() => {\n          d.resolve(result);\n        });\n        return d.promise;\n      },\n      /**\n       * Copies the template dir from the assets dir\n       * @param  {object} result The result\n       * @return {Function}        The promise\n       */\n      copyTemplate: (result) => {\n        let d = when.defer();\n        var {\n          theme, src, dest\n        } = result;\n        _.extend(src, {\n          template: Path.join(Path.join(\n              this.options.target.path, 'bower_components/'),\n            theme + '/template/')\n        });\n        _.extend(dest, {\n          template: Path.join(this.options.target.path, '/template/')\n        });\n\n        File.copy(src.template, dest.template, {\n          clobber: true\n        }, error => {\n          if (error) d.reject(error);\n          else {\n            d.resolve(result);\n          }\n        });\n        return d.promise;\n      },\n      /**\n       * Removes the bower dir from the target dir\n       * @param  {object} result The result\n       * @return {Function}        The promise\n       */\n      removeBowerDest: () => {\n        let d = when.defer();\n        del([\n          Path.join(\n            this.options.target.path,\n            'bower_components/')\n        ]).then(() => {\n          d.resolve({\n            path: Path.join(\n              this.options.target.path,\n              'template/') + 'index.jade'\n          });\n        });\n        return d.promise;\n      }\n    };\n\n    mkdirp(this.options.target.path, (error) => {\n      if (error) d.reject(error);\n      var promise;\n      // Decide between default template \n      // or provided template from bower\n      // and install it\n      if (!this.options.bower.isEnabled())\n        promise = commands.installTheme('doxx-theme-default');\n      else promise = commands.installTheme();\n\n      // Run through the commands\n      promise\n        .then(commands.copyBower)\n        .then(commands.removeBowerSrc)\n        .then(commands.copyAssets)\n        .then(commands.copyAssetCSS)\n        .then(commands.copyAssetJS)\n        .then(commands.deleteAssets)\n        .then(commands.copyTemplate)\n        .then(commands.removeBowerDest)\n        .then(d.resolve);\n    });\n\n    return d.promise;\n  }\n\n}\n\n\nexport default (bower) => {\n  return new Theme(bower);\n};"],"sourceRoot":"/source/"}