{"version":3,"sources":["doxx.js"],"names":[],"mappings":"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","file":"doxx.js","sourcesContent":["/*! global process */\n'use strict';\n\nimport File from 'fs';\nimport Path from 'path';\nimport _ from 'lodash';\nimport Compiler from './compiler';\nimport parser from './parser';\nimport Markdown from 'markdown-it';\nimport mkdirp from 'mkdirp';\nimport theme from './theme';\n/**\n * The main class that creates beautiful documentations.\n * @class Doxx\n * @extend Compiler\n */\nclass Doxx extends Compiler {\n  // Initialize the compiler\n  // and pass the parser.\n  constructor(options) {\n      super(parser(options));\n      // Set the locals stack\n      this.locals = [];\n    }\n    /**\n     * Generates the documentations.\n     */\n  generate() {\n    // Compute all symboles\n    var allSymbols = this.files.reduce(function (m, a) {\n      m = m.concat(a.symbols || []);\n      return m;\n    }, []);\n\n    var pkg;\n    // Get package.json\n    try {\n      pkg = require(process.cwd() + '/package');\n    } catch (err) {}\n\n    var readme = pkg && pkg.readme,\n      readMeFile = Path.resolve(process.cwd(), this.options.readme ||\n        (pkg && pkg.readmeFileName) || 'README.md');\n\n    if (!readme && File.existsSync(readMeFile)) {\n      readme = File.readFileSync(readMeFile).toString();\n    } else {\n      console.warn(\n        new Error('Doxx [warn]: No README.md file found at ' + readMeFile));\n    }\n\n    if (!readme) {\n      console.warn(\n        new Error('Doxx [warn]: Empty README.md ' + readMeFile));\n      readme = '';\n    }\n\n    var md = new Markdown();\n    md = md.render.bind(md);\n\n    // Get readme data\n    this.files.unshift({\n      name: 'Main',\n      targetName: 'index.html',\n      readme: md(readme),\n      dox: [],\n      symbols: []\n    });\n\n    // Set title\n    var title = pkg && pkg.name ? pkg.name :\n      this.options.title;\n\n    // Set description\n    var description = pkg && pkg.description ?\n      pkg.description : '';\n\n    // Set URLs\n    var url = {\n      github: pkg && pkg.homepage ?\n        pkg.homepage.indexOf('github') > -1 ?\n        pkg.homepage : false : false,\n      npm: pkg && pkg.name ?\n        'https://npmjs.com/package/' + pkg.name : false,\n      homepage: pkg && pkg.homepage ?\n        pkg.homepage.indexOf('github') === -1 ?\n        pkg.homepage : false : false\n    };\n\n    // Make sure the folder structure in target mirrors source\n    var folders = [];\n\n    this.files.forEach(file => {\n      var folder = file.targetName\n        .substr(0, file.targetName.lastIndexOf(Path.sep));\n\n      if ((folder !== '') && (folders.indexOf(folder) === -1)) {\n        folders.push(folder);\n        mkdirp.sync(this.options.target + '/' + folder);\n      }\n    });\n\n    // Render and write each file\n    this.files.forEach(file => {\n      // TEST\n      var targets = [];\n\n      // Set each files relName in relation \n      // to where this file is in the directory tree\n      this.files.forEach(function (f) {\n\n        // Count how deep the current file is in relation to base\n        var count = file.name.split('/');\n        count = count === null ? 0 : count.length - 1;\n\n        // relName is equal to targetName at the base dir\n        f.relName = f.targetName;\n        f.relPath = '';\n        // For each directory in depth of current file \n        // add a ../ to the relative filename of this link\n        while (count > 0) {\n          f.relName = '../' + f.relName;\n          f.relPath += '../';\n          count--;\n        }\n\n        console.log(file.targetName, f.targetName);\n        // TEST\n        targets.push({\n          files: {\n            name: f.name,\n            target: {\n              name: f.targetName\n            },\n            relative: {\n              name: f.relName,\n              path: f.relPath\n            }\n          }\n        });\n      });\n      file.targets = targets;\n    });\n\n    this.files.forEach((file) => {\n      // console.log(file.relName, this.files);\n      // Set locals\n      this.locals.push(_.assign({}, file, {\n        project: {\n          title, description, url, path: file.relPath\n        },\n        allSymbols: allSymbols,\n        files: this.files,\n        currentName: file.name\n      }));\n    });\n\n    // Install theme\n    theme(this.options).install().then((result) => {\n      var {\n        isCache, theme\n      } = result;\n\n      if (theme) {\n        console.info('Doxx [info]: Installed theme: ' +\n          theme + (isCache ? ' from cache.' : ''));\n      }\n      _.forEach(this.files, (file, index) => {\n        // Set template\n        this.setTemplate(result.template);\n        // Compile the template\n        let compiled = this.compile(this.locals[index]);\n        // Write files\n        mkdirp(this.options.target, error => {\n          if (error) return;\n          else\n            File.writeFileSync(Path.join(\n                this.options.target, file.targetName),\n              compiled);\n        });\n      });\n    }, console.error);\n  }\n}\nexport default function (options) {\n  return new Doxx(options);\n}"],"sourceRoot":"/source/"}