#!/usr/bin/env node
/* eslint-env node */
'use strict';
const Option = require('mr-doc-utils').Option;
const Log = require('../src/utils/log');
// TODO: Write tests for CLI.
const CLI = require('../src/cli');
const MrDoc = require('../');

// Parse the arguments.
const argv = CLI.parse();
// Get log level.
const level = argv.level || argv.l;
// Set up the logger.
const log = new Log(Option.log({
  level: level !== 'silent' ? level : ['info', 'warn'],
  silent: level === 'silent',
}));
// DEBUG: Launch
log.debug(log.color.blue('Launching CLI'));
// Launch the CLI.
CLI.launch(argv)
.then(stream => {
  MrDoc.cli(stream);
  // DEBUG: Land (with success)
  log.debug(log.color.blue('Landed CLI with success'));
}).catch(error => {
  if (error.level) log[error.level](error.message);
  // DEBUG: Land (with failure)
  log.debug(log.color.blue('Landed CLI with failure'));
});
